var page = (function () {

  var nameOpen = null;
  var $page = $(".page");


  var html = {
    intro: "<div class='intro'><a href='#!/'><svg class='title' viewBox='0 0 800 235'><path d='M0 6.75h9.13c1.88 0 3.33 0.52 4.35 1.56 1.01 1.04 1.52 2.67 1.52 4.89v80.86c0 2.03-0.56 3.62-1.67 4.75 -1.11 1.14-2.75 1.7-4.92 1.7H0v6.75h54.25v-6.74h-9.71c-1.93 0-3.62-0.6-5.07-1.81 -1.01-0.92-1.52-2.25-1.52-3.99V55.19h7.9c3.33 0 6.13 0.75 8.4 2.25 2.27 1.5 4.12 3.8 5.54 6.89 1.42 3.1 3.03 9.14 4.82 18.13 1.54 7.69 2.75 12.57 3.62 14.65 1.45 3.63 3.56 6.38 6.34 8.27 2.78 1.89 6.46 2.83 11.04 2.83 6.42 0 11.4-1.94 14.92-5.84 3.52-3.89 5.53-10.33 6.01-19.33h-6.37c-0.63 8.46-2.53 12.69-5.72 12.69 -1.16 0-2.2-0.6-3.11-1.81 -0.92-1.21-1.98-4.16-3.19-8.85 -1.94-7.3-4.43-13.56-7.48-18.78 -2.31-3.97-4.98-6.97-7.99-8.98 -3.01-2.01-7.32-3.48-12.91-4.4 11.15-1.11 19.41-3.53 24.77-7.25 7.05-4.88 10.57-11.26 10.57-19.13 0-4.93-1.4-9.41-4.2-13.44 -2.8-4.03-7.06-7.22-12.78-9.57S64.99 0 55.91 0H0V6.75zM37.95 14.94c0-3.43 0.58-5.64 1.74-6.63 1.16-0.99 4.01-1.49 8.55-1.49 8.45 0 14.39 1.58 17.82 4.75 3.43 3.17 5.14 8.18 5.14 15.05 0 7.45-1.74 12.74-5.21 15.88 -4.64 4.11-10.96 6.16-18.98 6.16h-9.05V14.94z'/><path d='M148.67 30.3l-26.88 64.27c-1.08 2.54-2.61 4.62-4.58 6.25 -1.39 1.15-3 1.73-4.83 1.73h-1.63v4.72h28.49v-4.72h-2.39c-2.81 0-5.03-0.68-6.65-2.06 -1.62-1.37-2.44-3.15-2.44-5.36 0-1.29 0.56-3.25 1.68-5.89l2.67-6.34h28.07l5.78 13.91c0.41 0.98 0.61 1.85 0.61 2.59 0 0.95-0.49 1.71-1.47 2.28 -0.98 0.58-2.77 0.86-5.37 0.86h-3.29v4.72h35.18v-4.72h-2.74c-1.55 0-2.81-0.34-3.75-1.01 -0.95-0.68-1.83-1.96-2.64-3.86L154.36 30.3H148.67zM158.1 77.92h-23.91l12.02-28.61L158.1 77.92z'/><path d='M206.82 41.41c-7.27 7.41-10.9 16.81-10.9 28.21 0 7.68 1.66 14.42 4.97 20.22 3.31 5.8 7.83 10.41 13.56 13.82 5.73 3.42 12.21 5.12 19.44 5.12 10.88 0 20-3.75 27.35-11.26 7.35-7.51 11.03-16.89 11.03-28.15 0-7.41-1.66-14.06-4.99-19.96 -3.33-5.9-7.98-10.56-13.94-13.98 -5.97-3.41-12.48-5.12-19.54-5.12C223.08 30.3 214.09 34 206.82 41.41zM244.79 38.49c3.08 2.22 5.39 5.58 6.95 10.1 1.55 4.51 2.33 11.27 2.33 20.27 0 12.85-1.81 21.87-5.42 27.06 -3.62 5.19-8.45 7.79-14.5 7.79 -4.09 0-7.67-1.12-10.75-3.35 -3.08-2.23-5.42-5.67-7.02-10.32 -1.61-4.65-2.41-11.49-2.41-20.52 0-8.59 0.87-15.35 2.61-20.29 1.74-4.94 4.09-8.51 7.05-10.73 2.96-2.21 6.45-3.32 10.47-3.32C238.15 35.17 241.72 36.28 244.79 38.49z'/><path d='M280.58 36.9h5.53c1.93 0 3.26 0.36 4.01 1.09 0.74 0.73 1.12 2.07 1.12 4.04v42.19c0 5.48 1 9.89 3.02 13.22 2.01 3.33 5.41 6.06 10.19 8.17 4.78 2.12 10.4 3.17 16.86 3.17 9.02 0 16.12-2.35 21.29-7.06 5.14-4.67 7.71-10.85 7.71-18.53v-34.57c0-3.32 0.78-6.1 2.33-8.35 1.55-2.25 3.82-3.38 6.79-3.38h1.98v-4.72h-28.59v4.72h1.12c3.04 0 5.47 1.01 7.28 3.05 1.81 2.03 2.71 5.08 2.71 9.14V80.96c0 4.47-0.77 8.17-2.31 11.12 -1.54 2.94-3.51 5.06-5.91 6.35 -3.28 1.73-6.93 2.59-10.95 2.59 -5.48 0-9.77-1.56-12.88-4.69 -3.11-3.13-4.66-7.62-4.66-13.48V41.31c0-1.49 0.3-2.6 0.91-3.32 0.61-0.73 1.45-1.09 2.54-1.09h7.66v-4.72h-37.72V36.9z'/><path d='M374.12 36.9c1.86 0 3.17 0.31 3.93 0.94 0.76 0.63 1.14 1.63 1.14 3.02v57.41c0 1.35-0.37 2.4-1.11 3.15 -0.74 0.75-1.84 1.12-3.3 1.12h-6.59v4.72h65.96l1.72-28.78h-4.56c-1.86 8.39-4.53 14.5-8.01 18.33 -3.48 3.83-7.23 5.74-11.25 5.74h-10.8c-2.64 0-4.31-0.31-5.02-0.94 -0.71-0.62-1.06-2.07-1.06-4.34v-55.84c0-1.59 0.37-2.74 1.12-3.45 0.74-0.71 2.04-1.07 3.9-1.07h6.49v-4.72h-38.48v4.72H374.12z'/><path d='M490.21 6.75h9.13c1.88 0 3.33 0.52 4.35 1.56 1.01 1.04 1.52 2.67 1.52 4.89v80.86c0 2.03-0.56 3.62-1.67 4.75 -1.11 1.14-2.75 1.7-4.93 1.7h-8.4v6.75h54.25v-6.74h-9.7c-1.93 0-3.62-0.6-5.07-1.81 -1.01-0.92-1.52-2.25-1.52-3.99V55.19h7.89c3.33 0 6.13 0.75 8.4 2.25 2.27 1.5 4.12 3.8 5.54 6.89 1.42 3.1 3.03 9.14 4.82 18.13 1.55 7.69 2.75 12.57 3.62 14.65 1.45 3.63 3.56 6.38 6.34 8.27 2.78 1.89 6.46 2.83 11.05 2.83 6.42 0 11.4-1.94 14.92-5.84 3.52-3.89 5.53-10.33 6.01-19.33h-6.37c-0.63 8.46-2.53 12.69-5.72 12.69 -1.16 0-2.2-0.6-3.11-1.81 -0.92-1.21-1.98-4.16-3.19-8.85 -1.94-7.3-4.43-13.56-7.48-18.78 -2.31-3.97-4.98-6.97-7.99-8.98 -3.02-2.01-7.32-3.48-12.91-4.4 11.15-1.11 19.41-3.53 24.77-7.25 7.05-4.88 10.57-11.26 10.57-19.13 0-4.93-1.4-9.41-4.2-13.44 -2.8-4.03-7.06-7.22-12.78-9.57S555.2 0 546.13 0h-55.91V6.75zM528.16 14.94c0-3.43 0.58-5.64 1.74-6.63 1.16-0.99 4.01-1.49 8.55-1.49 8.45 0 14.39 1.58 17.82 4.75 3.43 3.17 5.14 8.18 5.14 15.05 0 7.45-1.74 12.74-5.21 15.88 -4.63 4.11-10.96 6.16-18.98 6.16h-9.05V14.94z'/><path d='M605.52 36.9h5.53c1.93 0 3.26 0.36 4.01 1.09 0.74 0.73 1.12 2.07 1.12 4.04v42.19c0 5.48 1.01 9.89 3.02 13.22 2.01 3.33 5.41 6.06 10.19 8.17 4.78 2.12 10.4 3.17 16.86 3.17 9.02 0 16.12-2.35 21.29-7.06 5.14-4.67 7.71-10.85 7.71-18.53v-34.57c0-3.32 0.78-6.1 2.33-8.35 1.56-2.25 3.82-3.38 6.79-3.38h1.98v-4.72h-28.59v4.72h1.12c3.04 0 5.47 1.01 7.28 3.05 1.81 2.03 2.71 5.08 2.71 9.14V80.96c0 4.47-0.77 8.17-2.31 11.12 -1.54 2.94-3.51 5.06-5.91 6.35 -3.28 1.73-6.93 2.59-10.95 2.59 -5.47 0-9.77-1.56-12.88-4.69 -3.11-3.13-4.66-7.62-4.66-13.48V41.31c0-1.49 0.3-2.6 0.91-3.32 0.61-0.73 1.45-1.09 2.54-1.09h7.66v-4.72h-37.72V36.9z'/><path d='M692.62 36.9h6.69c1.62 0 2.81 0.34 3.58 1.01 0.76 0.68 1.14 1.73 1.14 3.15v57.46c0 1.32-0.41 2.32-1.24 3 -0.83 0.68-2.26 1.01-4.28 1.01h-5.88v4.72h38.43v-4.72h-6.18c-1.72 0-3.04-0.37-3.95-1.12 -0.71-0.57-1.06-1.54-1.06-2.89V40.4c0-1.15 0.34-2.02 1.01-2.61 0.68-0.59 1.76-0.89 3.24-0.89h6.95v-4.72h-38.43V36.9z'/><path d='M742 58.27h4.46c1.11-7.78 3.32-13.29 6.61-16.52 3.29-3.23 7.83-4.85 13.6-4.85h14.34l-41.85 65.64v4.72h59.42L800 79.03h-4.61c-1.12 6.16-2.59 10.88-4.42 14.16 -1.83 3.28-3.95 5.66-6.37 7.13 -2.42 1.47-5.29 2.21-8.6 2.21h-19.14l42.03-65.64v-4.72h-55.16L742 58.27z'/><path d='M2.18 133h8.47c2.94 0 4.99 0.41 6.12 1.23 1.13 0.82 1.7 2.1 1.7 3.84v82.53c0 1.88-0.57 3.38-1.7 4.5 -1.13 1.11-2.79 1.67-4.96 1.67H2.18v6.74h97.27l1.59-40.83H94.52c-1.35 11.41-4.83 19.94-10.43 25.6 -5.6 5.66-12.82 8.49-21.65 8.49H49.54c-2.9 0-5.12-0.53-6.66-1.59 -1.01-0.72-1.52-1.96-1.52-3.7v-39.67h4.13c6.42 0 11.23 1.69 14.41 5.08 3.19 3.38 5 9.21 5.43 17.48h6.52v-49.89h-6.52c-0.58 7.3-2.45 12.6-5.61 15.88 -3.16 3.29-7.62 4.93-13.36 4.93h-5v-37.2c0-1.6 0.51-2.84 1.52-3.73 1.01-0.89 2.65-1.34 4.93-1.34h14.63c5.89 0 10.66 0.97 14.3 2.9 3.65 1.93 6.59 4.85 8.84 8.74s4.12 10.26 5.61 19.11h6.37l-2.1-37.49H2.18V133z'/><path d='M193.27 156.55c-7.71 0-13.85 2.16-18.43 6.47 -4.58 4.31-6.87 9.88-6.87 16.72 0 4.06 0.83 7.5 2.48 10.32 1.66 2.82 4.25 5.21 7.78 7.15 3.53 1.95 9.43 3.83 17.7 5.66 6.14 1.32 9.99 2.28 11.54 2.89 2.84 1.12 4.93 2.58 6.28 4.39 1.35 1.81 2.03 4.05 2.03 6.72 0 3.82-1.54 7.01-4.61 9.56 -3.07 2.55-7.38 3.83-12.91 3.83 -13.54 0-22.52-7.94-26.94-23.81h-4.46v27.82h3.75l5.93-7.41c6.46 5.45 13.59 8.17 21.4 8.17 8.48 0 15.6-2.49 21.34-7.46 4.77-4.13 7.15-9.66 7.15-16.6 0-4.63-1.1-8.57-3.3-11.8 -2.2-3.23-5.5-5.83-9.91-7.79 -2.78-1.22-7.79-2.59-15.05-4.11 -6.21-1.28-10.56-2.52-13.04-3.72 -2.48-1.2-4.28-2.64-5.39-4.33 -1.11-1.69-1.67-3.55-1.67-5.58 0-3.41 1.41-6.35 4.23-8.8 2.82-2.45 6.48-3.67 10.98-3.67 5.27 0 10.09 1.85 14.45 5.56 4.36 3.71 7.72 9.28 10.09 16.73h4.56l-0.46-25.94h-3.6l-4.71 6.7C207.45 159.11 200.67 156.55 193.27 156.55L193.27 156.55z'/><path d='M322.58 158.25c-3.09-1.13-6.45-1.7-10.06-1.7 -9.16 0-17.15 3.2-23.98 9.59 -8.01 7.51-12.02 17.55-12.02 30.14 0 11.33 3.47 20.62 10.42 27.88 6.95 7.25 15.56 10.88 25.83 10.88 7.94 0 14.63-2.49 20.08-7.46 5.44-4.97 8.7-11.74 9.79-20.31h-4.56c-1.25 6.67-3.45 11.71-6.59 15.13 -4.36 4.7-9.73 7.06-16.12 7.06 -6.39 0-11.22-2.35-14.5-7.05 -4.09-5.98-6.13-15.15-6.13-27.49 0-11.66 1.86-20.2 5.58-25.62 3.72-5.41 8.42-8.12 14.09-8.12 5.17 0 9.77 2.1 13.79 6.29 4.02 4.2 6.76 10.63 8.21 19.29h4.67l-1.27-30.1h-3.75l-3.5 7.46C328.99 161.34 325.67 159.39 322.58 158.25z'/><path d='M422.53 156.55l-26.88 64.27c-1.08 2.54-2.61 4.62-4.58 6.24 -1.39 1.15-3 1.73-4.83 1.73h-1.63v4.72h28.49v-4.72h-2.39c-2.81 0-5.03-0.69-6.65-2.06 -1.62-1.37-2.44-3.15-2.44-5.36 0-1.28 0.56-3.25 1.68-5.89l2.67-6.34h28.07l5.78 13.91c0.41 0.98 0.61 1.85 0.61 2.59 0 0.95-0.49 1.71-1.47 2.29 -0.98 0.58-2.77 0.86-5.37 0.86h-3.29v4.72h35.18v-4.72h-2.74c-1.56 0-2.81-0.34-3.75-1.02 -0.95-0.68-1.83-1.96-2.64-3.86l-28.12-67.36H422.53zM431.96 204.17h-23.91l12.02-28.61L431.96 204.17z'/><path d='M511.86 163.15c1.86 0 3.17 0.31 3.93 0.94 0.76 0.63 1.14 1.63 1.14 3.02v57.41c0 1.35-0.37 2.4-1.11 3.15 -0.74 0.75-1.84 1.12-3.29 1.12h-6.59v4.72h65.96l1.73-28.78h-4.56c-1.86 8.39-4.53 14.5-8.01 18.33 -3.48 3.82-7.23 5.74-11.25 5.74h-10.8c-2.63 0-4.31-0.31-5.02-0.94 -0.71-0.62-1.06-2.07-1.06-4.34v-55.84c0-1.59 0.37-2.74 1.12-3.45 0.74-0.71 2.05-1.07 3.9-1.07h6.49v-4.72h-38.48v4.72H511.86z'/><path d='M617.06 163.15h5.93c2.06 0 3.49 0.29 4.29 0.86 0.79 0.58 1.19 1.47 1.19 2.69v57.77c0 1.32-0.4 2.37-1.19 3.15 -0.79 0.78-1.95 1.17-3.47 1.17h-6.74v4.72h68.09l1.12-28.58H681.7c-0.95 7.99-3.38 13.96-7.3 17.92 -3.92 3.96-8.97 5.94-15.16 5.94h-9.02c-2.03 0-3.58-0.37-4.66-1.12 -0.71-0.51-1.06-1.37-1.06-2.59v-27.77h2.89c4.5 0 7.86 1.19 10.09 3.55 2.23 2.37 3.5 6.45 3.8 12.23h4.56v-34.92h-4.56c-0.4 5.11-1.72 8.82-3.93 11.12 -2.21 2.3-5.33 3.45-9.35 3.45h-3.5v-26.04c0-1.12 0.36-1.99 1.07-2.61 0.71-0.63 1.86-0.94 3.45-0.94h10.24c4.12 0 7.46 0.68 10.01 2.03 2.55 1.35 4.61 3.39 6.19 6.12 1.57 2.73 2.88 7.18 3.93 13.38h4.46l-1.47-26.24h-65.3V163.15z'/><path d='M760.13 156.55c-7.71 0-13.85 2.16-18.43 6.47 -4.58 4.31-6.87 9.88-6.87 16.72 0 4.06 0.83 7.5 2.48 10.32 1.66 2.82 4.25 5.21 7.78 7.15 3.53 1.95 9.43 3.83 17.7 5.66 6.14 1.32 9.99 2.28 11.54 2.89 2.84 1.12 4.93 2.58 6.28 4.39 1.35 1.81 2.03 4.05 2.03 6.72 0 3.82-1.54 7.01-4.61 9.56 -3.07 2.55-7.38 3.83-12.91 3.83 -13.54 0-22.52-7.94-26.94-23.81h-4.46v27.82h3.75l5.93-7.41c6.46 5.45 13.59 8.17 21.4 8.17 8.48 0 15.6-2.49 21.34-7.46 4.77-4.13 7.15-9.66 7.15-16.6 0-4.63-1.1-8.57-3.3-11.8 -2.2-3.23-5.5-5.83-9.91-7.79 -2.78-1.22-7.79-2.59-15.05-4.11 -6.21-1.28-10.56-2.52-13.04-3.72 -2.48-1.2-4.28-2.64-5.39-4.33 -1.11-1.69-1.67-3.55-1.67-5.58 0-3.41 1.41-6.35 4.23-8.8 2.82-2.45 6.48-3.67 10.98-3.67 5.27 0 10.09 1.85 14.45 5.56 4.36 3.71 7.72 9.28 10.09 16.73h4.56l-0.46-25.94h-3.6l-4.71 6.7C774.31 159.11 767.53 156.55 760.13 156.55L760.13 156.55z'/></svg></a></div>",
    index: "<div class='inner'><h1>Index</h1></div>",
    credits: "<div class='inner'><h1>Credits</h1></div>"
  };


  function open(name) {

    if (name in html === false) return;


    if (nameOpen !== null && nameOpen !== name) { // If another page is open,
      close(function () { open(name); }); // Close it and set callback to open the requested page
      return;
    }

    console.log(name);

    nameOpen = name;
    $page.hide().html(html[name]).fadeIn(250);

    if (nameOpen === "intro") {
      $(".intro").vide({ mp4: "http://cf.pasoliniroma.com/static/ruiz/video/trois-couronnes-du-matelot-3.mp4" }, { loop: true, muted: true, position: "50% 50%" });
    }

  }

  function close(cb) {
    if (nameOpen === null) return;

    var callback = (typeof cb === "function" ? cb : _.noop);

    $(window).off("keyup");

    $page.fadeOut(250, function () {
      $page.empty();
      callback();
    });
    nameOpen = null;

  }

  function isOpen () {
    return nameOpen !== null;
  }

  return {
    open: open,
    close: close
  };

})();